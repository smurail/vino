{% extends "base.html" %}
{% load staticfiles %}
{% block head %}
    {{block.super}}
    <script src="{% static 'js/vendor/plotly-1.52.3.min.js' %}"></script>
    <script src="{% static 'js/visualization.js' %}"></script>
{% endblock %}
{% block body %}
    <div class="card mt-4">
        <div class="card-header py-2 d-flex align-items-center">
            <form id="action" class="form-inline">
                <label for="url">Visualize</label>
                <select name="kernel" class="custom-select custom-select-sm mx-sm-2">
                    {% for pk, title in kernels %}
                    <option value="{{ pk }}">{{ title }}</option>
                    {% endfor %}
                </select>
                <button type="submit" class="btn btn-sm btn-primary">Plot</button>
            </form>
            <div class="loader spinner-grow spinner-grow-sm ml-auto" role="status">
                <span class="sr-only">Loading...</span>
            </div>
        </div>
        <div class="card-body p-0">
            <div class="view"></div>
        </div>
    </div>
    <script>

class KernelVisualization extends Visualization {
    constructor(element) {
        super(element);
        this.form = this.element.querySelector('form');
        this.kernel = this.form.elements['kernel'];
        this.button = this.form.querySelector('button');
        this.addEventListener('load', e => {
            this.kernel.disabled = this.button.disabled = true;
        });
        this.addEventListener('plotend', e => {
            this.kernel.disabled = this.button.disabled = false;
        });
        this.form.addEventListener('submit', e => {
            this.load();
            e.preventDefault();
        });
        this.kernel.addEventListener('change', e => this.load());
        setTimeout(this.load.bind(this), 1);
    }

    url(pk) {
        return "{% url 'kernel_data' 42 %}".replace('42', pk);
    }

    load() {
        super.load(this.url(this.kernel.value));
    }
}

document.addEventListener('DOMContentLoaded', () => {
    new KernelVisualization('.card');
});

    </script>
{% endblock %}
