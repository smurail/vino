{% extends "base.html" %}
{% load staticfiles %}
{% block head %}
    {{block.super}}
    <script src="{% static 'js/vendor/plotly-1.52.3.min.js' %}"></script>
    <script src="{% static 'js/visualization.js' %}"></script>
{% endblock %}
{% block body %}
    <div class="card mt-4">
        <div class="card-header py-2 d-flex align-items-center">
            <form id="action">
                <fieldset class="form-inline">
                    <label for="url">Visualize</label>
                    <div class="form-group mx-sm-2">
                        <input type="text" id="url" name="url" class="form-control form-control-sm" size="50" value="/kernel/1/data">
                    </div>
                    <button type="submit" class="btn btn-sm btn-primary">Plot</button>
                </fieldset>
            </form>
            <div class="loader spinner-grow spinner-grow-sm ml-auto" role="status">
                <span class="sr-only">Loading...</span>
            </div>
        </div>
        <div class="card-body p-0">
            <div class="view"></div>
        </div>
    </div>
    <script>

class KernelVisualization extends Visualization {
    constructor(element) {
        super(element);
        this.form = this.element.querySelector('form');
        this.fieldset = this.element.querySelector('fieldset');
        this.url = this.form.elements['url'];
        this.addEventListener('load', e => this.fieldset.disabled = true);
        this.addEventListener('plotend', e => this.fieldset.disabled = false);
        this.form.addEventListener('submit', e => {
            this.load();
            e.preventDefault();
        });
        setTimeout(this.load.bind(this), 1);
    }

    load() {
        super.load(this.url.value);
    }
}

document.addEventListener('DOMContentLoaded', () => {
    new KernelVisualization('.card');
});

    </script>
{% endblock %}
